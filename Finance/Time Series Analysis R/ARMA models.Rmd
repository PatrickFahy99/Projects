#ARMA(1,1) model with alpha_1 = 0.5, beta_1 = -0.5

set.seed(1)
x <- arima.sim(n=1000, model=list(ar=0.5, ma=-0.5))
plot(x)

acf(x)

arima(x, order=c(1, 0, 1))

0.6785 + c(-1.96, 1.96)*0.167
-0.7311 + c(-1.96, 1.96)*0.155

#ARMA(2,2) with alpha_1 = 0.5, alpha_2 = -0.25, beta_1 = 0.5, beta_2 = -0.3
x <- arima.sim(n=1000, model=list(ar=c(0.5, -0.25), ma=c(0.5, -0.3)))

plot(x)

acf(x)

arima(x, order=c(2, 0, 2))

# CI for AR part
0.3569 + c(-1.96, 1.96)*0.1411
-0.228 + c(-1.96, 1.96)*0.0356

# CI for MA part
0.6464 + c(-1.96, 1.96)*0.1436
-0.1493 + c(-1.96, 1.96)*0.1275

# Choosing the best ARMA(p,q) model
set.seed(3)
x <- arima.sim(n=1000, model=list(ar=c(0.5, -0.25, 0.4), ma=c(0.5, -0.3)))

final.aic <- Inf
final.order <- c(0,0,0)
for (i in 0:4) for (j in 0:4) {
  current.aic <- AIC(arima(x, order=c(i, 0, j)))
  if (current.aic < final.aic) {
    final.aic <- current.aic
    final.order <- c(i, 0, j)
    final.arma <- arima(x, order=final.order)
  }
}

final.aic

final.order

final.arma

acf(resid(final.arma))

# Perform Ljung-Box test for 20 Lags to confirm this is goooood
Box.test(resid(final.arma), lag=20, type="Ljung-Box")
#0.869 >> 0.05 so really good model


# Financial data:
require(quantmod)

getSymbols("^GSPC")
sp = diff(log(Cl(GSPC)))

spfinal.aic <- Inf
spfinal.order <- c(0,0,0)
for (i in 0:4) for (j in 0:4) {
  spcurrent.aic <- AIC(arima(sp, order=c(i, 0, j)))
  if (spcurrent.aic < spfinal.aic) {
    spfinal.aic <- spcurrent.aic
    spfinal.order <- c(i, 0, j)
    spfinal.arma <- arima(sp, order=spfinal.order)
  }
}

spfinal.order

acf(resid(spfinal.arma), na.action=na.omit)
# Quite a few high peaks, especially at higher lags.

Box.test(resid(spfinal.arma), lag=20, type="Ljung-Box")
# p-val is very small so this model isnt very goooood
# Hence there is additional autocorrelation in the residuals
# that is not explained by the fitted ARMA(2,3) model.


